#!/bin/bash

eval "$(curl -k -s https://gitlab.com/uniqueops/ava/raw/master/var/global)"                             # Add Global Functions

STATUS_INFO="$Color_White[--]$Color_Reset"                                                              # Declare Info Status
STATUS_WARNING="$Color_Yellow[??]$Color_Reset"                                                          # Declare Warning Status
STATUS_PASS="$Color_Green[OK]$Color_Reset"                                                              # Declare Passing Status
STATUS_FAIL="$Color_Red[!!]$Color_Reset"                                                                # Declare Failing Status

echo -e "\\nWhat is the domain?"                                                                        # Ask For The Domain
#read -r domain;                                                                                        # Put Domain Into Variable
domain=""

if [ -z "$domain" ]; then
  init_table "Error Detected"
  add_row "$STATUS_FAIL" "Please input a valid domain name."
  print_table
  exit 1                                                                                                # End Script
fi

domain=${domain//[[:blank:]]/}                                                                          # Remove Spaces & Tabs
domain=${domain#*//};                                                                                   # Remove HTTP:// or HTTPS://
domain=${domain#*www.};                                                                                 # Remove WWW.
domain=${domain%/};                                                                                     # Remove Trailing /
#domain=${domain} | cut -f1 -d"/";                                                                      # Remove Any Directories Added

echo "Corrected to $domain"                                                                             # Echo Domain For Testing Purposes                                                                                      # Declare Failing Status

function print_row() {                                                                                  # Create Function To Print Table Rows
  format="%-${status_size}s%b %-${info_size}s%b\\n"                                                     # Declare Row Format
  printf "$format" "" "${status[$1]}" "${info[$1]}"                                                     # Add Prefix ("") To Fields With Colors
}

function Global_Nameserver_Check() {                                                                    # Generate Nameserver Check Row
  Global_Nameserver_Check_Status="$STATUS_FAIL"                                                         # Set Status For Nameserver Check
  Global_Nameserver_Check_Info=$(dig ns +short "$domain" | sort | sed -e :a -e '$!N; s/\n/ | /; ta');   # Grab Nameservers For Domain
  if [ -n "$Global_Nameserver_Check_Info" ]; then
    new_row "$STATUS_INFO" "Global Nameservers: $Global_Nameserver_Check_Info"
    new_row "$STATUS_PASS" "Parent nameserver's returned listed nameservers."
  else
    Global_Nameserver_Check_Info="Parent nameserver's dont have your domain's nameservers listed."
    new_row "$Global_Nameserver_Check_Status" "$Global_Nameserver_Check_Info"
  fi
}                                                                           # Generate Table