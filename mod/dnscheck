#!/bin/bash

eval "$(curl -k -s https://gitlab.com/uniqueops/ava/raw/master/var/global)"                             # Add Global Functions

STATUS_INFO="$Color_White[--]$Color_Reset"                                                              # Declare Info Status
STATUS_WARNING="$Color_Yellow[??]$Color_Reset"                                                          # Declare Warning Status
STATUS_PASS="$Color_Green[OK]$Color_Reset"                                                              # Declare Passing Status
STATUS_FAIL="$Color_Red[!!]$Color_Reset"                                                                # Declare Failing Status

echo -e "\\nWhat is the domain?"                                                                        # Ask For The Domain
#read -r domain;                                                                                        # Put Domain Into Variable
domain=""

if [ -z "$domain" ]; then
  init_table -h2 "Error Detected"
  add_row -C1 -t --Blue "$STATUS_FAIL" "Please input a valid domain name."
  print_table
  exit 1                                                                                                # End Script
fi

domain=${domain//[[:blank:]]/}                                                                          # Remove Spaces & Tabs
domain=${domain#*//};                                                                                   # Remove HTTP:// or HTTPS://
domain=${domain#*www.};                                                                                 # Remove WWW.
domain=${domain%/};                                                                                     # Remove Trailing /
#domain=${domain} | cut -f1 -d"/";                                                                      # Remove Any Directories Added

echo -e "Corrected to $domain\\n"                                                                             # Echo Domain For Testing Purposes                                                                                      # Declare Failing Status

function Global_Nameserver_Check() {                                                                    # Generate Nameserver Check Row
  Global_Nameserver_Check_Info=$(dig ns +short "$domain" | sort | sed -e :a -e '$!N; s/\n/ | /; ta');   # Grab Nameservers For Domain
  if [ -n "$Global_Nameserver_Check_Info" ]; then
    Global_Nameserver_Check_Status="$STATUS_PASS"                                                       # Set Status For Nameserver Check
    #new_row "$STATUS_INFO" "Global Nameservers: $Global_Nameserver_Check_Info"
    printf "$STATUS_INFO Global Nameservers: $Global_Nameserver_Check_Info\\n"
    #new_row "$STATUS_PASS" "Parent nameserver's returned listed nameservers."
    printf "$STATUS_PASS Parent nameserver's returned listed nameservers.\\n"
  else
    Global_Nameserver_Check_Status="$STATUS_FAIL"                                                       # Set Status For Nameserver Check
    Global_Nameserver_Check_Info="Parent nameserver's dont have your domain's nameservers listed."
    #new_row "$STATUS_FAIL" "$Global_Nameserver_Check_Info"
    printf "$STATUS_FAIL $Global_Nameserver_Check_Info\\n"
  fi
}

Global_Nameserver_Check
echo -e ""