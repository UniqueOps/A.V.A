#!/bin/bash
# Description: Quick information for servers
# Contributors: Casey McLaughlin

#Initialize variables to default values.
OPT_V=V #Standard Flag for Verbose Mode
OPT_T=T #Standard Flag for Ticket Mode

#Help function
function HELP() {
  echo -e "\n$Color_Blue====================$Color_Reset Uptime, Load Averages and Other Logged In Users $Color_Blue====================$Color_Reset";
  echo -e "Help documentation for ${Color_Bold}Switches Template.${Color_Reset}"\\n
  echo -e "Command line switches are optional. The following switches are recognized."
  echo -e "${Color_Inverted}-v${Color_Reset}  --Enables Verbose Mode: Displays standard output of a script."
  echo -e "${Color_Inverted}-t${Color_Reset}  --Enables Ticket Mode: Displays output into a ticket format."
  echo -e "${Color_Inverted}-h${Color_Reset}  --Displays this help message. No further functions performed."\\n
  echo -e "\n$Color_Blue=========================================================================================$Color_Reset";
  exit 1
}

#Check the number of arguments. If none are passed, print help and exit.
NUMARGS=$#
if [ $NUMARGS -eq 0 ]; then
  HELP
fi

### Start getopts code ###

# Keep the leading ":" in front of flags 

while getopts ":cnosth" FLAG; do
  case "${FLAG}" in
    v)
      echo -e "\n$Color_Blue====================$Color_Reset Uptime, Load Averages and Other Logged In Users $Color_Blue====================$Color_Reset\n";
      w;
      echo -e "\n$Color_Blue=========================================================================================$Color_Reset";
      # Detect any screens and what is currently running in them
      SCREEN=$(screen -ls 2>/dev/null | grep -v "No Sockets found in /var/run/screen/S-root."); 
      INFO=$(ps faux | grep -v grep | grep -A2 "SCREEN" | egrep "SCREEN|_"); 
      if [[ -n $INFO ]]; then echo -e "\n$Color_Blue========================================$Color_Reset Screens $Color_Blue========================================$Color_Reset\n $SCREEN \n$INFO \n$Color_Blue=========================================================================================$Color_Reset"; fi
      ;;
    t)
      echo -e "- Performed \`w\`";
      echo -e "\`\`\`";
      w;
      echo -e "\`\`\`";
      # Detect any screens and what is currently running in them
      SCREEN=$(screen -ls 2>/dev/null | grep -v "No Sockets found in /var/run/screen/S-root."); 
      INFO=$(ps faux | grep -v grep | grep -A2 "SCREEN" | egrep "SCREEN|_"); 
      if [[ -n $INFO ]]; then 
        echo -e "- Performed \`screen -ls 2>/dev/null | grep -v \"No Sockets found in /var/run/screen/S-root.\"\`";
        echo -e "\`\`\`";
        echo -en "$SCREEN";
        echo -e "\`\`\`";        
        echo -e "- Performed \`ps faux | grep -v grep | grep -A2 \"SCREEN\" | egrep \"SCREEN|_\"\`";
        echo -e "\`\`\`";
        echo -e "$INFO";
        echo -e "\`\`\`";
      fi
      ;;
    h)
      HELP
      ;;
    \?) # Send to Help (Unrecognized Flag)
      HELP
      ;;
  esac
done

shift $((OPTIND-1))  #This tells getopts to move on to the next argument.

### End getopts code ###

exit 0
